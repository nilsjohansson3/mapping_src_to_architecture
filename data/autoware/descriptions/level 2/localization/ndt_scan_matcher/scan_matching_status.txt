<img src="./media/diagnostic_scan_matching_status.png" alt="drawing" width="600"/>

| Name                                             | Description                                                                            | Transition condition to Warning                                                                                                                                                                                                                                                                                                                                          | Transition condition to Error | Whether to reject the estimation result (affects `skipping_publish_num`)                            |
| ------------------------------------------------ | -------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------- | --------------------------------------------------------------------------------------------------- |
| `topic_time_stamp`                               | the time stamp of input topic                                                          | none                                                                                                                                                                                                                                                                                                                                                                     | none                          | no                                                                                                  |
| `sensor_points_size`                             | the size of sensor points                                                              | the size is 0                                                                                                                                                                                                                                                                                                                                                            | none                          | yes                                                                                                 |
| `sensor_points_delay_time_sec`                   | the delay time of sensor points                                                        | the time is **longer** than `sensor_points.timeout_sec`                                                                                                                                                                                                                                                                                                                  | none                          | yes                                                                                                 |
| `is_succeed_transform_sensor_points`             | whether transform sensor points is succeed or not                                      | none                                                                                                                                                                                                                                                                                                                                                                     | failed                        | yes                                                                                                 |
| `sensor_points_max_distance`                     | the max distance of sensor points                                                      | the max distance is **shorter** than `sensor_points.required_distance`                                                                                                                                                                                                                                                                                                   | none                          | yes                                                                                                 |
| `is_activated`                                   | whether the node is in the "activate" state or not                                     | not "activate" state                                                                                                                                                                                                                                                                                                                                                     | none                          | if `is_activated` is false, then estimation is not executed and `skipping_publish_num` is set to 0. |
| `is_succeed_interpolate_initial_pose`            | whether the interpolate of initial pose is succeed or not                              | failed. <br> (1) the size of `initial_pose_buffer_` is **smaller** than 2. <br> (2) the timestamp difference between initial_pose and sensor pointcloud is **longer** than `validation.initial_pose_timeout_sec`. <br> (3) distance difference between two initial poses used for linear interpolation is **longer** than `validation.initial_pose_distance_tolerance_m` | none                          | yes                                                                                                 |
| `is_set_map_points`                              | whether the map points is set or not                                                   | not set                                                                                                                                                                                                                                                                                                                                                                  | none                          | yes                                                                                                 |
| `iteration_num`                                  | the number of times calculate alignment                                                | the number of times is **larger** than `ndt.max_iterations`                                                                                                                                                                                                                                                                                                              | none                          | yes                                                                                                 |
| `local_optimal_solution_oscillation_num`         | the number of times the solution is judged to be oscillating                           | the number of times is **larger** than 10                                                                                                                                                                                                                                                                                                                                | none                          | yes                                                                                                 |
| `transform_probability`                          | the score of how well the map aligns with the sensor points                            | the score is **smaller** than`score_estimation.converged_param_transform_probability` (only in the case of `score_estimation.converged_param_type` is 0=TRANSFORM_PROBABILITY)                                                                                                                                                                                           | none                          | yes                                                                                                 |
| `transform_probability_diff`                     | the tp score difference for the current ndt optimization                               | none                                                                                                                                                                                                                                                                                                                                                                     | none                          | no                                                                                                  |
| `transform_probability_before`                   | the tp score before the current ndt optimization                                       | none                                                                                                                                                                                                                                                                                                                                                                     | none                          | no                                                                                                  |
| `nearest_voxel_transformation_likelihood`        | the score of how well the map aligns with the sensor points                            | the score is **smaller** than `score_estimation.converged_param_nearest_voxel_transformation_likelihood` (only in the case of `score_estimation.converged_param_type` is 1=NEAREST_VOXEL_TRANSFORMATION_LIKELIHOOD)                                                                                                                                                      | none                          | yes                                                                                                 |
| `nearest_voxel_transformation_likelihood_diff`   | the nvtl score difference for the current ndt optimization                             | none                                                                                                                                                                                                                                                                                                                                                                     | none                          | no                                                                                                  |
| `nearest_voxel_transformation_likelihood_before` | the nvtl score before the current ndt optimization                                     | none                                                                                                                                                                                                                                                                                                                                                                     | none                          | no                                                                                                  |
| `distance_initial_to_result`                     | the distance between the position before convergence processing and the position after | the distance is **longer** than `validation.initial_to_result_distance_tolerance_m`                                                                                                                                                                                                                                                                                      | none                          | no                                                                                                  |
| `execution_time`                                 | the time for convergence processing                                                    | the time is **longer** than `validation.critical_upper_bound_exe_time_ms`                                                                                                                                                                                                                                                                                                | none                          | no                                                                                                  |
| `skipping_publish_num`                           | the number of times rejected estimation results consecutively                          | the number of times is `validation.skipping_publish_num` or more                                                                                                                                                                                                                                                                                                         | none                          | -                                                                                                   |

※The `sensor_points_callback` shares the same callback group as the `trigger_node_service` and `ndt_align_service`. Consequently, if the initial pose estimation takes too long, this diagnostic may become stale.